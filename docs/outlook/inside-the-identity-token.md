
# Подробные сведения о маркере удостоверения Exchange
Сведения о содержимом маркера удостоверения Exchange 2013.



Маркер удостоверения проверки подлинности, который отправляется сервером Exchange в надстройку Outlook, не анализируется надстройкой. Вам не требуется изучать маркер, чтобы отправить его на сервер. Однако при составлении кода веб-службы, который взаимодействует с надстройками Outlook, необходимо знать устройство маркера удостоверения.

## Что такое маркер удостоверения?


Маркер удостоверения — это кодированная строка URL-адреса в формате base-64, которая самостоятельно заверяется отправляющим ее сервером Exchange. Маркер не кодируется, и открытый ключ, который используется для проверки подписи, хранится на сервере Exchange, выпустившем маркер. Маркер состоит из трех частей: заголовок, полезные данные и подпись. В строке маркера эти части разделяются символом ".", чтобы было удобнее разбить маркер.

Exchange 2013 использует веб-маркер JSON (JWT) в качестве маркера удостоверения. Сведения о маркерах JWT см. в разделе [JSON Web Token (JWT), интернет-проект](http://self-issued.info/docs/draft-goland-json-web-token-00.html).


### Заголовок маркера удостоверения

Заголовок идентифицирует маркер и позволяет веб-службе понять, какой тип маркера предоставляется. В следующем примере показано, как выглядит маркер удостоверения.

```js
{ "typ" : "JWT", "alg" : "RS256", "x5t" : "Un6V7lYN-rMgaCoFSTO5z707X-4" }
```

В следующей таблице описаны части заголовка маркера удостоверения.


**Части заголовка маркера удостоверения**


|**Утверждение**|**Значение**|**Описание**|
|:-----|:-----|:-----|
|тип|"JWT"|Идентифицирует маркер в качестве веб-маркера JSON. Все маркеры удостоверений, предоставляемых сервером Exchange, являются маркерами JWT.|
|alg|"RS256"|Алгоритм хэширования, который используется для создания подписки. Все маркеры, предоставляемые сервером Exchange, используют алгоритм RS-256.|
|x5t|Отпечаток сертификата|Отпечаток маркера X.509.|

### Полезные данные маркера удостоверения

Полезные данные содержат утверждения проверки подлинности, которые идентифицируют учетную запись электронной почты, а также сервер Exchange, который отправляет маркер. В следующем примере показано, как выглядит раздел полезных данных.
```js

{ 
   "aud" : "https://mailhost.contoso.com/IdentityTest.html", 
   "iss" : "00000002-0000-0ff1-ce00-000000000000@mailhost.contoso.com", 
   "nbf" : "1331579055", 
   "exp" : "1331607855", 
   "appctxsender":"00000002-0000-0ff1-ce00-000000000000@mailhost.context.com",
   "isbrowserhostedapp":"true",
"appctx" : { 
     "msexchuid" : "53e925fa-76ba-45e1-be0f-4ef08b59d389@mailhost.contoso.com" "version" : "ExIdTok.V1" "amurl" :         "https://mailhost.contoso.com:443/autodiscover/metadata/json/1" 
     } 
}
```
В следующей таблице описаны части полезных данных маркера удостоверения.


**Части полезной загрузки маркера удостоверения**


|**Утверждение**|**Описание**|
|:-----|:-----|
|aud|URL-адрес надстройка, запросившего маркер. Маркер действителен, если отправлен из надстройка, работающего в браузере клиента. Если надстройка использует версию 1.1 схемы манифеста Надстройки Office, этот URL-адрес указан в первом элементе  **SourceLocation** для типа формы **ItemRead** или **ItemEdit** (в зависимости от того, какой из них указан первым в элементе [FormSettings](http://msdn.microsoft.com/en-us/library/0d1a311d-939d-78c1-e968-89ddf7ebc4b4%28Office.15%29.aspx) манифеста надстройки).|
|iss|Уникальный идентификатор сервера Exchange, выпустившего маркер. Все маркеры, выпущенные сервером Exchange, будут иметь одинаковый идентификатор.|
|nbf|Дата и время начала срока действия маркера. Значением является количество секунд с 1 января 1970 г. |
|exp|Дата и время окончания срока действия маркера. Значением является количество секунд с 1 января 1970 г.|
|appctxsender|Уникальный идентификатор для сервера Exchange, который отправляет контекст приложения.|
|isbrowserhostedapp|Указывает, размещается ли надстройка в браузере.|
|appctx|Контекст приложения для маркера. |
Сведения в утверждении appctx предоставляют адрес учетной записи электронной почты, а также уникальный идентификатор учетной записи. В следующей таблице приведены части утверждения appctx.



|**часть утверждения appctx**|**Описание**|
|:-----|:-----|
|msexchuid|Уникальный идентификатор, связанный с учетной записью электронной почты и сервером Exchange.|
|version|Номер версии маркера. Во всех маркерах, предоставляемых сервером с Exchange 2013, значение этого параметра равно "ExIdTok.V1".|
|amurl|URL-адрес документа метаданных проверки подлинности, который содержит открытый ключ сертификата X.509, который использовался для подписи маркера. Дополнительные сведения об использовании документа метаданных проверки подлинности см. в разделе [Проверка маркера удостоверения Exchange](../outlook/validate-an-identity-token.md).|

### Подпись маркера удостоверения

Подпись создается путем хэширования разделов заголовка и полезных данных с использованием алгоритма, указанного в заголовке, а также самозаверяющего сертификата X509, размещенного на сервере в месте, указанном в полезных данных. Веб-служба может проверить эту подпись, чтобы убедиться в происхождении маркера удостоверения именно на том сервере, который должен был отправить такой маркер.


## Дополнительные ресурсы



- [Проверка подлинности надстройки Outlook с помощью маркеров удостоверения Exchange](../outlook/authentication.md)
    
- [Вызов службы из надстройки Outlook с использованием маркера удостоверения в Exchange](../outlook/call-a-service-by-using-an-identity-token.md)
    
- [Использование библиотеки проверки маркеров Exchange](../outlook/use-the-token-validation-library.md)
    
- [Проверка маркера удостоверения Exchange](../outlook/validate-an-identity-token.md)
    
