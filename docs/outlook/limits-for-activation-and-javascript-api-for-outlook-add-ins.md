
# Ограничения для активации и API JavaScript для надстроек Outlook

Чтобы предоставить пользователям удобные возможности работы в надстройках Outlook, следует помнить об определенных рекомендациях по активации и использованию интерфейса API и разрабатывать надстройки в соответствии с ними. Эти рекомендации созданы для того, чтобы отдельная надстройка не могла отнимать у Exchange Server или Outlook слишком много времени для обработки правил активации или вызовов API JavaScript для Office, что может повлиять на общую работу Outlook и других надстроек. Эти ограничения относятся к созданию правил активации в манифесте надстройки, а также к использованию настраиваемых свойств, параметров перемещения, получателей, запросов и ответов Веб-службы Exchange (EWS) и асинхронных вызовов. 

 >**Примечание.** Если надстройка работает в полнофункциональном клиенте Outlook, также необходимо убедиться, что она не использует больше ресурсов, чем разрешено. 


## Ограничения для правил активации


При разработке правил активации надстроек Outlook придерживайтесь следующих рекомендаций.


- Размер манифеста не должен превышать 256 КБ. Если это ограничение будет превышено, установить надстройку Outlook для почтового ящика Exchange будет невозможно.

- Задавайте не более 15 правил активации для надстройки. Если это ограничение будет превышено, установить надстройку не удастся.
    
- Если правило [ItemHasKnownEntity](http://msdn.microsoft.com/en-us/library/87e10fd2-eab4-c8aa-bec3-dff92d004d39%28Office.15%29.aspx) применяется к тексту сообщения выбранного элемента, следует ожидать, что полнофункциональный клиент Outlook будет применять его только к первому мегабайту текста сообщения, а не ко всему тексту, если его объем превышает это ограничение. Надстройка не будет активирована, если соответствия присутствуют только после первого мегабайта текста сообщения. Если вы считаете такой сценарий вероятным, измените условия активации.
    
- Если вы используете регулярные выражения в правилах **ItemHasKnownEntity** и [ItemHasRegularExpressionMatch](http://msdn.microsoft.com/en-us/library/bfb726cd-81b0-a8d5-644f-2ca90a5273fc%28Office.15%29.aspx), помните о следующих ограничениях и рекомендациях, которые обычно применяются к любому ведущему приложению Outlook, а также ограничениях, описанных в таблицах 1, 2 и 3, которые зависят от ведущего приложения:
    
      - Задавайте не более пяти регулярных выражений в правилах активации для надстройки. В противном случае вам не удастся установить надстройку.
    
  - Задавайте регулярные выражения таким образом, чтобы ожидаемые результаты возвращались в первых 50 совпадениях, с помощью вызова метода **getRegExMatches**.
    
  - Может указывать утверждения с просмотром вперед, но не поддерживает утверждения с просмотром назад (?<=текст) и отрицательные утверждения с просмотром назад (?<!текст) в регулярных выражениях.
    

В таблице 1 перечислены ограничения и описаны различия в поддержке регулярных выражений в полнофункциональном клиенте Outlook, Outlook Web App и Outlook Web App для устройств. Поддержка не зависит от типа устройства и основного текста элемента.


 **Таблица 1. Основные различия в поддержке регулярных выражений**


|**Расширенный клиент Outlook**|**Outlook Web App или OWA для устройств**|
|:-----|:-----|
|Использует обработчик регулярных выражений C++, который предоставляется как часть библиотеки стандартных шаблонов Visual Studio. Этот обработчик выполняет компиляцию в соответствии со стандартами ECMAScript 5. |Использует оценку регулярных выражений, которая является частью JavaScript, предоставляется браузером и поддерживает расширенный набор стандартов ECMAScript 5.|
|Из-за использования различных модулей регулярное выражение, которое включает особый класс символов на основе предопределенных классов символов, может возвращать различные результаты в полнофункциональном клиенте Outlook, Outlook Web App и Outlook Web App для устройств.<br/><br/>Например, регулярное выражение "[\s\S]{0,100}" соответствует любому количеству (от 0 до 100) одиночных символов, включая пробелы. Это регулярное выражение возвращает разные результаты в полнофункциональном клиенте Outlook, Outlook Web App и Outlook Web App для устройств. Чтобы обойти эту проблему, следует переписать его в виде ""(\s\|\S){0,100}". Такое регулярное выражение соответствует любому количеству символов (от 0 до 100), включая пробелы.<br/><br/>Тщательно проверьте каждое регулярное выражение в каждом ведущем приложении Outlook. Если обнаружатся разные результаты, перепишите соответствующее регулярное выражение. |Тщательно проверьте каждое регулярное выражение в каждом ведущем приложении Outlook. Если обнаружатся разные результаты, перепишите соответствующее регулярное выражение.|
|По умолчанию продолжительность оценки всех регулярных выражений для надстройки ограничивается 1 секундой. При превышении этого ограничения выполняется повторная оценка до 3 раз. Полнофункциональный клиент Outlook не только ограничивает повторную оценку, но и отключает запуск надстройки для одного и того же почтового ящика во всех ведущих приложениях Outlook.<br/><br/>Администраторы могут переопределить эти ограничения в разделах реестра **OutlookActivationAlertThreshold** и **OutlookActivationManagerRetryLimit**.|Не поддерживаются такие же параметры реестра и мониторинга ресурсов, как в полнофункциональном клиенте Outlook. Однако надстройки с регулярными выражениями, для оценки которых требуется слишком много времени в полнофункциональном клиенте Outlook, отключаются для одного и того же почтового ящика во всех ведущих приложениях Outlook.|

В таблице 2 перечислены ограничения и описаны различия частей основного текста элемента, к которым каждое приложение Outlook применяет регулярные выражения. Некоторые из этих ограничений зависят от типа устройства и основного текста элемента, если регулярное выражение применяется к основному тексту элемента.

**Таблица 2. Ограничения на размер оцениваемого содержания элемента**


||**Полнофункциональный клиент Outlook**|**Outlook Web App, OWA для устройств, OWA для iPad или OWA для iPhone**|**Outlook Web App**|
|:-----|:-----|:-----|:-----|
|Конструктивные параметры|Любое поддерживаемое устройство|Смартфоны Android, iPad или iPhone|Все поддерживаемые устройства, кроме смартфонов Android, iPad и iPhone|
|Основной текст элемента в виде обычного текста|Регулярное выражение применяется к первому мегабайту данных в основном тексте. К остальной части основного текста свыше этого ограничения регулярное выражение не применяется.|Надстройка активируется, только если основной текст сообщения содержит < 16 000 символов.|Надстройка активируется, только если основной текст сообщения содержит < 500 000 символов.|
|Основной текст элемента в формате HTML|Регулярное выражение применяется к первым 512 КБ данных в основном тексте. К остальной части основного текста свыше этого ограничения регулярное выражение не применяется. (Фактическое количество знаков зависит от кодировки, в которой может использоваться от 1 до 4 байтов на каждый знак.)|Регулярное выражение применяется к первым 64 000 знаков (включая знаки HTML-тегов). К остальной части основного текста свыше этого ограничения регулярное выражение не применяется.|Надстройка активируется, только если основной текст сообщения содержит < 500 000 символов.|

В таблице 3 перечислены ограничения и описаны различия в соответствиях, которые каждое ведущее приложение Outlook возвращают после оценки регулярного выражения. Поддержка не зависит от конкретного типа устройства, но может зависеть от типа основного текста элемента, если регулярное выражение применяется к основному тексту элемента.

**Таблица 3. Ограничения на возвращаемые соответствия**


||**Полнофункциональный клиент Outlook**|**Outlook Web App или OWA для устройств**|
|:-----|:-----|:-----|
|Порядок возвращаемых соответствий|Предполагайте, что выражение **getRegExMatches** возвращает для того же регулярного выражения, применяемого к тому же элементу, в расширенном клиенте Outlook, Outlook Web App и OWA для устройств.|Предполагайте, что **getRegExMatches** возвращает соответствия в расширенном клиенте Outlook, Outlook Web App и OWA для устройств в разном порядке.|
|Основной текст элемента в виде обычного текста|**getRegExMatches** возвращает не более 50 соответствий длиной до 1536 символов (1,5 КБ).<br/><br/>**Примечание**. **getRegExMatches** не возвращает соответствия в определенном порядке. В целом, порядок соответствий для одного и того же регулярного выражения, применяемого к одному и тому же элементу, в полнофункциональном клиенте Outlook, Outlook Web App и Outlook Web App для устройств отличается.|**getRegExMatches** возвращает не более 50 соответствий длиной до 3072 символов (3 КБ).|
|Основной текст элемента в формате HTML|**getRegExMatches** возвращает не более 50 соответствий длиной до 3072 символов (3 КБ).<br/> <br/> **Примечание**. **getRegExMatches** не возвращает соответствия в определенном порядке. В целом, порядок соответствий для одного и того же регулярного выражения, применяемого к одному и тому же элементу, в полнофункциональном клиенте Outlook, Outlook Web App и Outlook Web App для устройств отличается.|**getRegExMatches** возвращает не более 50 соответствий длиной до 3072 символов (3 КБ).|

## Ограничения для API JavaScript


Помимо указанных выше рекомендаций для правил активации, все ведущие приложения Outlook требуют соблюдения определенных ограничений в объектной модели JavaScript, как описано в таблице 4.


**Таблица 4. Ограничения при получении или записи определенных данных с помощью JavaScript API для Office**


|**Функция**|**Ограничение**|**Связанный API**|**Описание**|
|:-----|:-----|:-----|:-----|
|Настраиваемые свойства|2500 символов|Объект [CustomProperties](../../reference/outlook/CustomProperties.md)<br/> <br/>Метод [item.loadCustomPropertiesAsync](../../reference/outlook/Office.context.mailbox.item.md)|Ограничение для всех настраиваемых свойств элемента встречи или сообщения. Все ведущие приложения Outlook возвращают ошибку, если общий размер всех настраиваемых свойств надстройки превышает это ограничение.|
|Параметры перемещения|32 КБ символов|Объект [RoamingSettings](../../reference/outlook/RoamingSettings.md)<br/><br/> Свойство [context.roamingSettings](../../reference/outlook/Office.context.md)|Ограничение для всех параметров перемещения надстройки. Все ведущие приложения Outlook возвращают ошибку, если параметры превышают это ограничение.|
|Извлечение известных сущностей|2000 символов|Метод [item.getEntities](../../reference/outlook/Office.context.mailbox.item.md)<br/> <br/>Метод [item.getEntitiesByType](../../reference/outlook/Office.context.mailbox.item.md)<br/> <br/>Метод [item.getFilteredEntitiesByName](../../reference/outlook/Office.context.mailbox.item.md)|Ограничение для Exchange Server для извлечения известных сущностей в основном тексте элемента. Exchange Server игнорирует сущности сверх этого предела. Обратите внимание, что это ограничение не зависит от того, использует ли надстройка правило **ItemHasKnownEntity**.|
|Веб-службы Exchange|1 МБ символов|Метод [mailbox.makeEwsRequestAsync](../../reference/outlook/Office.context.mailbox.md)|Ограничение для запроса или ответа на вызов **Mailbox.makeEwsRequestAsync**.|
|Получатели|100 получателей|Свойство [item.requiredAttendees](../../reference/outlook/Office.context.mailbox.item.md)<br/> <br/>Свойство [item.optionalAttendees](../../reference/outlook/Office.context.mailbox.item.md)<br/> <br/>Свойство [item.resources](../../reference/outlook/Office.context.mailbox.item.md)<br/> <br/>Свойство [item.to](../../reference/outlook/Office.context.mailbox.item.md)<br/> <br/>Свойство [item.cc](../../reference/outlook/Office.context.mailbox.item.md)<br/> <br/>Метод [Recipients.addAsync](../../reference/outlook/Recipients.md)<br/> <br/>Метод [Recipient.getAsync](../../reference/outlook/Recipients.md)<br/> <br/>Метод [Recipient.setAsync](../../reference/outlook/Recipients.md)|Ограничение для получателей, указанных в каждом свойстве.|
|Отображаемое имя|255 символов|Свойство [EmailAddressDetails.displayName](../../reference/outlook/simple-types.md)<br/><br/> Объект [Recipients](../../reference/outlook/Recipients.md)<br/><br/> Свойство **item.requiredAttendees**<br/><br/> Свойство **item.optionalAttendees** <br/><br/>Свойство **item.resources** <br/><br/>Свойство **item.to** <br/><br/>Свойство **item.cc**|Ограничение длины отображаемого имени в сообщении или встрече.|
|Настройка темы|255 символов|Метод [mailbox.displayNewAppointmentForm](../../reference/outlook/Office.context.mailbox.md)<br/><br/> Метод [Subject.setAsync](../../reference/outlook/Subject.md)|Ограничение для темы в форме новой встречи или для настройки темы встречи или сообщения.|
|Установка расположения|255 символов|Метод [Location.setAsync](../../reference/outlook/Location.md)|Ограничение для установки расположении встречи или приглашения на собрание.|
|Текст в форме новой встречи|32 КБ символов|Метод **Mailbox.displayNewAppointmentForm**|Ограничение текста в форме новой встречи.|
|Отображение текста существующего элемента|32 КБ символов|Метод [mailbox.displayAppointmentForm](../../reference/outlook/Office.context.mailbox.md)<br/><br/> Метод [mailbox.displayMessageForm](../../reference/outlook/Office.context.mailbox.md)|Для Outlook Web App и Outlook Web App для устройств: ограничение текста в существующей форме встречи или сообщения.|
|Настройка текста|1 МБ символов|Метод [Body.prependAsync](../../reference/outlook/Body.md)<br/> <br/>[Body.setAsync](../../reference/outlook/Body.md)<br/><br/>Метод [Body.setSelectedDataAsync](../../reference/outlook/Body.md)|Ограничение для установки текста элемента встречи или сообщения.|
|Число вложений|499 файлов в Outlook Web App и OWA для устройств|Метод [item.addFileAttachmentAsync](../../reference/outlook/Office.context.mailbox.item.md)|Ограничение числа файлов, которые можно вложить в элемент для отправки. В целом, Outlook Web App и OWA для устройств применяют ограничение в 499 файлов с помощью пользовательского интерфейса и **addFileAttachmentAsync**. Расширенный клиент Outlook явно не ограничивает количество файловых вложений. Однако все ведущие приложения Outlook соблюдают ограничение размера вложений, настроенное для Exchange Server пользователя. См. следующую строку, "Размер вложений".|
|Размер вложений|В зависимости от Exchange Server|Метод **item.addFileAttachmentAsync**|Для размера всех вложений в элементе существует ограничение, которое администратор может настроить в Exchange Server почтового ящика пользователя. В полнофункциональном клиенте Outlook это значение ограничивает количество вложений для элемента. В Outlook Web App и Outlook Web App для устройств для фактических вложений в элементе используется меньшее из двух ограничений (количества вложений и размера всех вложений).|
|Имя файла вложения|255 символов|Метод **item.addFileAttachmentAsync**|Ограничение длины имени файла вложения, добавляемого в элемент.|
|URI вложения|2048 символов|Метод **item.addFileAttachmentAsync**|Ограничение URI имени файла, добавляемого в элемент как вложение.|
|Идентификатор вложения|100 символов|Метод [item.addItemAttachmentAsync](../../reference/outlook/Office.context.mailbox.item.md)<br/><br/> Метод [item.removeAttachmentAsync](../../reference/outlook/Office.context.mailbox.item.md)|Ограничение длины идентификатора вложения, добавляемого в элемент или удаляемого из него.|
|Асинхронные вызовы|3 вызова|Метод **item.addFileAttachmentAsync**<br/><br/>Метод **item.addItemAttachmentAsync**<br/><br/><br/>Метод **item.removeAttachmentAsync**<br/><br/> Метод [Body.getTypeAsync](../../reference/outlook/Body.md)<br/><br/>Метод **Body.prependAsync**<br/><br/>Метод **Body.setSelectedDataAsync**<br/><br/> Метод [CustomProperties.saveAsync](../../reference/outlook/CustomProperties.md)<br/><br/><br/> Метод [item.LoadCustomPropertiesAysnc](../../reference/outlook/Office.context.mailbox.item.md)<br/><br/><br/> Метод [Location.getAsync](../../reference/outlook/Location.md)<br/><br/>Метод **Location.setAsync**<br/><br/> Метод [mailbox.getCallbackTokenAsync](../../reference/outlook/Office.context.mailbox.md)<br/><br/> Метод [mailbox.getUserIdentityTokenAsync](../../reference/outlook/Office.context.mailbox.md)<br/><br/> Метод [mailbox.makeEwsRequestAsync](../../reference/outlook/Office.context.mailbox.md)<br/><br/>Метод **Recipients.addAsync**<br/><br/> Метод [Recipients.getAsync](../../reference/outlook/Recipients.md)<br/><br/>Метод **Recipients.setAsync**<br/><br/> Метод [RoamingSettings.saveAsync](../../reference/outlook/RoamingSettings.md)<br/><br/> Метод [Subject.getAsync](../../reference/outlook/Subject.md)<br/><br/>Метод **Subject.setAsync**<br/><br/> Метод [Time.getAsync](../../reference/outlook/Time.md)<br/><br/> Метод [Time.setAsync](../../reference/outlook/Time.md)|Для Outlook Web App или OWA для устройств существует ограничение числа одновременных асинхронных вызовов, поскольку браузеры разрешают только ограниченное количество асинхронных вызовов на сервер. |

## Дополнительные ресурсы



- [Развертывание и установка надстроек Outlook для тестирования](../outlook/testing-and-tips.md)
    
- [Конфиденциальность, разрешения и безопасность для надстроек Outlook](../outlook/../../docs/develop/privacy-and-security.md)
    
