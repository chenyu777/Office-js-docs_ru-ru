# Отладка команд надстроек с помощью ведения журнала в среде выполнения

В клиентах Office 16 для настольных систем доступна новая функция, позволяющая вносить в журнал полезные сведения. Помимо прочего, это средство помогает диагностировать ошибки в манифесте надстройки, что особенно полезно при создании манифестов с командами надстроек. 

Полная документация по этой функции готовится к выпуску, но ниже описано, как использовать ее для отладки при анализе манифестов с командами надстроек.

##Включение ведения журнала в среде выполнения

**Важно!** Ведение журнала в среде выполнения **сказывается на производительности**. Включайте его, только если нужно выполнить отладку надстроек.

1. Убедитесь, что ваша сборка поддерживает ведение журнала в среде выполнения. Вам потребуются клиентские приложения **Office 16 для настольных систем** с версией сборки не ниже **16.0.7019**.
2. Добавьте раздел реестра `RuntimeLogging` в раздел `HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\Wef\Developer\`. 
3. В качестве значения по умолчанию задайте полный путь к файлу, в который будет записываться журнал. См. [пример раздела реестра](RuntimeLogging/EnableRuntimeLogging.zip) (требуется распаковка).

Реестр должен выглядеть следующим образом: ![](http://i.imgur.com/Sa9TyI6.png)

Если требуется отключить эту функцию, просто удалите раздел из реестра. 

##Диагностика проблем, связанных с командами
Ведение журнала в среде выполнения помогает находить трудные для выявления **проблемы в манифесте** (например, несоответствие идентификаторов ресурсов или недопустимая длина), не обнаруженные при проверке на соответствие схеме XSD. 

Попробуйте следующее:
 
1. Следуйте указаниям в файле [Readme](https://github.com/OfficeDev/Office-Add-in-Commands-Samples/blob/master/README.md), чтобы загрузить неопубликованную надстройку. 
2. Если проект кнопок ленты не отображается, а диалоговое окно надстроек остается пустым, проверьте журналы.
3. Выполните поиск по идентификатору надстройки, определенному в манифесте, чтобы найти сообщения, относящиеся к этой надстройке. В журнале этот идентификатор указывается в качестве `SolutionId`. Рекомендуем не загружать несколько неопубликованных надстроек одновременно, чтобы журнал не переполнялся сообщениями, не относящимися к нужной надстройке. 

В приведенном ниже примере с помощью ведения журнала в среде выполнения удалось обнаружить элемент управления, который указывает на несуществующий файл ресурса. Чтобы устранить эту проблему, необходимо исправить опечатку (если она была допущена) или создать отсутствующий ресурс.

![](http://i.imgur.com/f8bouLA.png) 

##Известные проблемы с ведением журнала
Нам известны некоторые ошибки, связанные с ведением журнала в среде выполнения, которые еще не были исправлены. Могут отображаться непонятные или неправильно классифицированные сообщения. Например:

- Сообщения `Medium  Current host not in add-in's host list` с дополнением `Unexpected Parsed manifest targeting different host` неправильно классифицируются. Они не являются ошибками, поэтому их можно спокойно игнорировать.
- Сообщение `Unexpected   Add-in is missing required manifest fields  DisplayName` не содержит SolutionId проблемной надстройки. Тем не менее, скорее всего, оно НЕ связано с надстройкой, отладка которой выполняется. 
- Все сообщения `Monitorable` относятся к ошибкам, которые система ожидает. Иногда они указывают на проблему с манифестом (например, опечатку в элементе, которая была пропущена, но не привела к сбою). 

