
# Форматирование таблиц в надстройках для Excel


В этой статье описываются различные функции API форматирования и их использование. В этом выпуске вы можете программным путем указывать форматирование ячеек и некоторые другие параметры только для таблиц (не для структур данных  **Office.CoercionType.Text** или **Office.CoercionType.Matrix**) и только в надстройках Excel. Настройка форматирования в надстройке состоит в следующем.

- Пользователь выбирает таблицу (или место для ее вставки программным путем), а затем ваша надстройка может вызвать метод  **Document.setSelectedDataAsync** для этой таблицы, чтобы настроить форматирование.

- Однако если в книге уже есть связанные таблицы (или ваша надстройка использует один из методов "addFrom" объекта [Bindings](../../reference/shared/bindings.bindings.md) для создания связанных таблиц при его инициализации), надстройка может вызвать метод **Binding.setDataAsync** для этих привязанных таблиц, чтобы задать форматирование.
    
>**Важно!** Чтобы форматировать таблицы в надстройках Excel с помощью новых и обновленных методов, в проекте надстройки необходимо [использовать Office.js 1.1 или более поздней версии (возможно, ее понадобится для этого обновить)](../../docs/develop/update-your-javascript-api-for-office-and-manifest-schema-version.md).

## Установка форматирования

Для установки форматирования вам необходимо создать литерал объекта JavaScript, содержащий одну или несколько пар "ключ-значение". Вы можете объединить серию параметров форматирования в список в объекте JavaScript. Например: 


```js
var myFormat = {fontStyle:"bold", width:"autoFit", borderColor:"purple"};
```

Чтобы применить форматирование, передайте объект JavaScript одному из методов, поддерживающих форматирование данных и другие функции таблицы.

Работать с форматированием можно двумя способами:


- Когда надстройка впервые записывает данные в выделенный фрагмент или привязку, задав необязательный параметр _cellFormat_ или _tableOptions_ в объекте _options_, который передается методу [Document.setSelectedDataAysnc](../../reference/shared/document.setselecteddataasync.md) или [Binding.setDataAsync](../../reference/shared/binding.setdataasync.md);
    
- После первой настройки форматирование можно [очистить или обновить](#очистить-или-обновить), используя один из специальных методов.
    

## Использование необязательных параметров в методах записи данных

Чтобы указать форматирование для привязок таблиц, можно использовать следующие необязательные параметры при настройке данных с помощью метода **Document.setSelectedData** или **Binding.setDataAsync**: _tableOptions_ и _cellFormat_.


### Необязательный параметр tableOptions

Используйте необязательные параметры _tableOptions_, чтобы указать стили таблиц по умолчанию, а также включить и отключить определенные компоненты таблиц, например: **строки заголовков**, **строки итогов** и **чередующиеся строки**. Значение, которое вы передаете в качестве параметра _tableOptions_, — это объект JavaScript, содержащий список пар "ключ-значение". Пример:


```js
tableOptions: {bandedRows: true, filterButton: false, style:"TableStyleMedium3"};
```


### Необязательный параметр cellFormat

Используйте необязательный параметр _cellFormat_, чтобы изменить значения форматирования ячеек, например ширину, высоту, шрифт, фон, выравнивание и т. д. Значение, передаваемое в виде параметра _cellFormat_, — это массив со списком объектов JavaScript, которые указывают целевые ячейки и тип форматирования. Пример:


```js
cellFormat: 
    [{cells: {row: 1}, format: {fontColor: "yellow"}}, 
        {cells: Office.Table.Headers, format: {fontColor: "yellow"}}, 
        {cells: {row: 3, column: 4}, format: {borderColor: "white", fontStyle: "bold"}]
```

Вы можете сочетать несколько пар `cells:` и `format:` в массиве _cellFormat_, чтобы сократить количество необходимых вызовов функций.


#### cells

Используйте свойство `cells:`, чтобы указать диапазон столбцов, строк и ячеек, к которым нужно применить форматирование.


**Поддерживаемые диапазоны значений ячеек**


|**Параметры диапазона cells**|**Описание**|
|:-----|:-----|
| `{row: i}`|Указывает диапазон, который расширяется до i-й строки данных в таблице.|
| `{column: i}`|Указывает диапазон, который расширяется до i-го столбца данных в таблице.|
| `{row: i, column: j}`|Указывает диапазон ячеек от i-й строки данных до j-го столбца данных в таблице.|
| `Office.Table.All`|Указывает всю таблицу, включая заголовки столбцов, данные и итоги (если они имеются)|
| `Office.Table.Data`|Указывает только данные в таблице (без заголовков и итогов).|
| `Office.Table.Headers`|Указывает только строку заголовков.|

#### format

Используйте свойство `format:`, чтобы указать форматирование, которое нужно применить к диапазону, определенному с помощью свойства `cells:`, в виде списка пар "ключ-значение" JavaScript. Список поддерживаемых значений см. в разделе [Поддерживаемые ключи и значения форматирования](#Поддерживаемые-ключи-и-значения-форматирования).

 **Ограничения при указании форматирования для Excel Online**

Количество _групп форматирования_, передаваемых параметру _cellFormat_ в Excel Online, не может превышать 100. Одна группа форматирования состоит из набора вариантов форматирования, применяемого к указанному диапазону ячеек. (Другими словами, все, что указано в одном из литералов объекта `cells:` в массиве, передаваемом параметру _cellFormat_.) Например, указанный ниже вызов передает параметру _cellFormat_ две группы форматирования.




```js
Office.context.document.setSelectedDataAsync(
    {cellFormat:[{cells: {row: 1}, format: {fontColor: "yellow"}}, 
        {cells: {row: 3, column: 4}, format: {borderColor: "white", fontStyle: "bold"}}]}, 
    function (asyncResult){});
```


#### Применение необязательных параметров

В этом выпуске только методы **Document.setSelectedDataAsync** и **TableBinding.setDataAsync** поддерживают запись данных и установку форматирования для таблиц в одном вызове с помощью необязательных параметров _tableOptions_ и _cellFormat_. В приведенных ниже примерах значение `tableData`, передаваемое в первый параметр каждого метода (параметр _data_), должно быть объектом [TableData](../../reference/shared/tabledata.md), который содержит определение таблицы и данных для записи.

 **Пример Document.setSelectedDataAsync**




```js
Office.context.document.setSelectedDataAsync(tableData, 
    {tableOptions: {headerRow:false}, 
        cellFormat: [{cells: Office.Table.Headers, format: {fontColor: "yellow"}}]}, 
    function (asyncResult) {});
```

 **Пример TableBinding.setDataAsync**




```js
Office.select("bindings#myBinding").setDataAsync(tableData, 
    {tableOptions: {headerRow:false}, 
        cellFormat: [{cells: Office.Table.Headers, format: {fontColor: "yellow"}}]}, 
    function (asyncResult) {});
```

 >**Примечание.** Вызов `Office.select("bindings#myBinding")` подразумевает, что привязка `myBinding` уже есть на листе.


## Обновление и очистка форматирования


Необязательные параметры _cellFormat_ и _tableOptions_ методов **Document.setSelectedDataAsync** или **TableBinding.setDataAsync** задают форматирование только при первом вызове. Чтобы обновить или очистить форматирование, необходимо использовать три новых метода объекта **TableBinding**: **setFormatsAsync**, **setTableOptionsAsync** и **clearFormatsAsync**.


### Обновление форматирования

Метод [TableBinding.setFormatsAsync](../../reference/shared/binding.tablebinding.setformatsasync.md) предназначен только для обновления форматирования ячейки, например ширины, высоты, шрифта, фона и выравнивания. Для него необходим параметр _cellFormat_:


```js
Office.select("bindings#myBinding").setFormatsAsync(
    [{cells: {row: 1}, format: {fontColor: "yellow"}}, 
        {cells: {row: 3, column: 4}, format: {borderColor: "white", fontStyle: "bold"}}], 
    function (asyncResult){});
```

Метод [TableBinding.setTableOptionsAsync](../../reference/shared/binding.tablebinding.settableoptionsasync.md) предназначен только для обновления параметров таблицы, например чередующихся строк и кнопок фильтрации. Для него обязательным является параметр _tableOptions_:




```js
var tableOptions = {bandedRows: true, filterButton: false, style: "TableStyleMedium3"}; 

Office.select("bindings#myBinding").setTableOptionsAsync(tableOptions, function(asyncResult){});
```


### Удаление форматирования

Метод [TableBinding.clearFormatsAsync](../../reference/shared/binding.tablebinding.clearformatsasync.md) очищает все форматирование в таблице. Он использует необязательный параметр _asyncContext_ и необязательную функцию обратного вызова:


```js
Office.select("bindings#myBinding").clearFormatsAsync();
```


## Поддерживаемые ключи и значения форматирования


В следующих таблицах представлены поддерживаемые пары "ключ-значение", которые вы можете передавать в параметр _cellFormat_ или _tableOptions_.

Доступные параметры для значений `format:` соответствуют подмножеству параметров в диалоговом окне **Формат ячеек** (щелкните правой кнопкой мыши и выберите пункт **Формат ячеек** или выберите элементы **Формат** > **Формат ячеек** на вкладке ленты **Главная**). Доступные параметры для значений `tableOptions:` соответствуют параметрам в группах **Параметры стилей таблицы** и **Стили таблиц** на вкладке ленты **Работа с таблицами** |**Конструктор**.


 >**Важно!**  Методы форматирования API поддерживают только параметры и значения, приведенные ниже. Если вы укажете другие параметры или значения форматирования, способ обработки будет не определен и необязательно будет одинаковым на всех поддерживаемых платформах. Не следует разрабатывать надстройки на основе побочных эффектов этих неопределенных способов обработки для определенной платформы. Однако неопределенные способы обработки не должны негативно влиять на состояние и интерфейс надстройки или документы, с которыми они взаимодействуют.


**Выравнивание**


|**Клавиша**|**Значения**|**Примечания**|
|:-----|:-----|:-----|
| `alignHorizontal:`|"general" \| "left" \| "center" \| "right" \| "fill" \| "justify" \| "center across selection" \| "distributed"|Поддерживаются только следующие комбинации с отступом:<br/><br/><ul><li><code>alignHorizontal: "left"</code> и <code>indentLeft: \<value\></code>;</li></ul><ul><li><code>alignHorizontal: "right"</code> и <code>indentRight: \<value\></code>;</li></ul><ul><li><code>alignHorizontal: "distributed"</code> и <code>indentDistributed: \<value\></code>.</li></ul>|
| `alignVertical:`|"top" \| "center" \| "bottom" \| "justify" \| "distributed"||



**Общие сведения**


|**Клавиша**|**Значения**|**Примечания**|
|:-----|:-----|:-----|
| `backgroundColor:`|"none" \| \<Все предопределенные названия цветов\> \| #RRGGBB|Предопределенные названия цветов:<br/><br/>"black", "blue", "gray", "green", "orange", "pink", "purple", "red", "teal", "turquoise", "violet", "white", "yellow"|



**Граница**


|**Клавиша**|**Значения**|**Примечания**|
|:-----|:-----|:-----|
| `borderStyle:`|"none" \| \<Все предопределенные названия стилей границ\>|Предопределенные названия стилей границ:<br/><br/>"штрихпунктир", "штрихпунктир с 2 точками", "штрих", "пунктир", "двойной", "сверхтонкая", "средний штрихпунктир", "средний штрихпунктир с 2 точками", "средний штрих", "средняя", "штрихпунктир с наклоном", "жирная", "тонкая"<br/><br/>Применяется ко всем границам в указанном диапазоне. (Эквивалентно указанию стилей границ с помощью параметров **Внешние** и **Внутренние** на вкладке **Граница** диалогового окна **Формат ячеек**.)<br/><br/> **Примечание.** В отличие от Excel Online, приложение Excel 2013 поддерживает отрисовку всех 13 предопределенных стилей границ. В таблице ниже описано, как стили границ отображаются при открытии электронной таблицы в Excel Online.<br/><br/><table><tr><th>Excel 2013</th><th>Excel Online</th></tr><tr><td>"штрихпунктир"</td><td>обозначенная штрихами (1 пкс)</td></tr><tr><td>"штрих-пунктир с 2 точками"</td><td>обозначенная пунктиром (1 пкс)</td></tr><tr><td>"штрих"</td><td>обозначенная штрихами (1 пкс)</td></tr><tr><td>"пунктир"</td><td>обозначенная пунктиром (1 пкс)</td></tr><tr><td>"двойная"</td><td>двойная (3 пкс)</td></tr><tr><td>"сверхтонкая"</td><td>сплошная (1 пкс)</td></tr><tr><td>"средний штрих-пунктир"</td><td>обозначенная штрихами (2 пкс)</td></tr><tr><td>"средний штрих-пунктир с 2 точками"</td><td>обозначенная пунктиром (2 пкс)</td></tr><tr><td>"средний штрих"</td><td>обозначенная штрихами (2 пкс)</td></tr><tr><td>"средняя"</td><td>сплошная (2 пкс)</td></tr><tr><td>"штрих-пунктир с наклоном"</td><td>обозначенная штрихами (2 пкс)</td></tr><tr><td>"жирная"</td><td>сплошная (3 пкс)</td></tr><tr><td>"тонкая"</td><td>сплошная (1 пкс)</td></tr></table>|
| `borderColor:`|"automatic" \| \<Все предопределенные названия цветов\> \| #RRGGBB|Применяется ко всем границам в указанном диапазоне.|
| `borderTopStyle:`|"none" \| \<Все предопределенные названия стилей границ\>|Применяется ко всем границам в указанном диапазоне.|
| `borderTopColor:`|"automatic" \| \<Все предопределенные названия цветов\> \| #RRGGBB|Применяется ко всем границам в указанном диапазоне.|
| `borderBottomStyle:`|"none" \| \<Все предопределенные названия стилей границ\>|Применяется ко всем границам в указанном диапазоне.|
| `borderBottomColor:`|"automatic" \| \<Все предопределенные названия цветов\> \| #RRGGBB|Применяется ко всем границам в указанном диапазоне.|
| `borderLeftStyle:`|"none" \| \<Все предопределенные названия стилей границ\>|Применяется ко всем границам в указанном диапазоне.|
| `borderLeftColor:`|"automatic" \| \<Все предопределенные названия цветов\> \| #RRGGBB|Применяется ко всем границам в указанном диапазоне.|
| `borderRightStyle:`|"none" \| \<Все предопределенные названия стилей границ\>|Применяется ко всем границам в указанном диапазоне.|
| `borderRightColor:`|"automatic" \| \<Все предопределенные названия цветов\> \| #RRGGBB|Применяется ко всем границам в указанном диапазоне.|
| `borderOutlineStyle:`|"none" \| \<Все предопределенные названия стилей границ\>|Применяется ко всем границам в указанном диапазоне.|
| `borderOutlineColor:`|"automatic" \| \<Все предопределенные названия цветов\> \| #RRGGBB|Применяется ко всем границам в указанном диапазоне.|
| `borderInlineStyle:`|"none" \| \<Все предопределенные названия стилей границ\>|Применяется только ко внутренним границам в указанном диапазоне. (Эквивалентно указанию стилей границ с использованием только предустановки  **Внутри** на вкладке **Граница** диалогового окна **Форматирование ячеек**.)|
| `borderInlineColor:`|"automatic" \| \<Все предопределенные названия цветов\> \| #RRGGBB|Применяется только ко внутренним границам указанного диапазона. |



**Ширина, высота и перенос текста ячейки**


|**Клавиша**|**Значения**|
|:-----|:-----|
| `width:`|"auto fit" \|  **Число**|
| `height:`|"auto fit" \|  **Число**|
| `wrapping:`|**Логический**|



**Шрифт**


|**Клавиша**|**Значения**|**Примечания**|
|:-----|:-----|:-----|
| `fontFamily:`|\<Все доступные названия шрифтов\>|Если заданный в Excel Online шрифт недоступен в браузере, API попытается использовать один из таких шрифтов: Segoe UI, Thonburi, Arial, Verdana и Microsoft Sans Serif. Если ни один из них не доступен, будет использован шрифт браузера по умолчанию.|
| `fontStyle:`|"regular" \| "italic" \| "bold" \| "bold italic"|**Примечание**. На момент этой публикации установка значения italic, а затем значения bold (или наоборот) для параметра `fontStyle:` приведет к объединению этих параметров. Например, если сначала вы установите значение italic, а затем значение bold, будет применено значение bold italic. Чтобы применить _только_ полужирный шрифт или курсив к диапазону, к которому уже применен полужирный шрифт или курсив, необходимо сначала установить значение `fontStyle:"regular"`, чтобы очистить предыдущее форматирование.|
| `fontSize:`|**Число**||
| `fontUnderlineStyle:`|"none" \| "single" \| "double" \| "single accounting" \| "double accounting"||
| `fontColor:`|"automatic" \| \<Все предопределенные названия цветов\> \| #RRGGBB||
| `fontDirection:`|"context" \| "left-to-right" \| "right-to-left"|Сейчас Excel Online не поддерживает отображение текста справа налево. Однако если надстройка задает такое направление при работе в Excel Online, этот параметр сохраняется в файле книги и отображается правильно при открытии книги в классическом приложении Excel.|
| `fontStrikethrough:`|**Логический**||
| `fontSuperscript:`|**Логический**||
| `fontSubScript:`|**Логический**||
| `fontNormal:`|**Логический**|Устанавливает обычные шрифт, начертание, размер и эффекты. При этом восстанавливается форматирование шрифта ячейки по умолчанию. Эквивалентно установке флажка **Обычный** на вкладке **Шрифт** диалогового окна **Формат ячеек**.|



**Отступ**


|**Клавиша**|**Значения**|**Примечания**|
|:-----|:-----|:-----|
| `indentLeft:`|**Число**|Поддерживается только следующая комбинация с выравниванием:<br/><br/><ul><li><code>alignHorizontal: "left"</code> и <code>indentLeft: \<value\></code>.</li></ul>|
| `indentRight:`|**Число**|Поддерживается только следующая комбинация с выравниванием:<br/><br/><ul><li><code>alignHorizontal: "right"</code> и <code>indentRight: \<value\></code>.</li></ul>|
| `indentDistributed:`|**Число**|Поддерживается только следующая комбинация с выравниванием:<br/><br/><ul><li><code>alignHorizontal: "distributed"</code> и <code>indentDistributed: \<value\></code>.</li></ul>|



**Форматирование чисел**


|**Клавиша**|**Значения**|**Примечания**|
|:-----|:-----|:-----|
| `numberFormat:`|**Строка**|Чтобы указать форматирование чисел, используйте строку пользовательского числового формата. Например, чтобы указать два десятичных разряда с запятой в качестве разделителя групп разрядов, укажите:<br/><br/> `numberFormat:"#,###.00"`<br/><br/>Это те же строки формата, которые можно [создать с помощью категории "Пользовательский формат" на вкладке "Число" в диалоговом окне "Формат ячеек"](http://office.microsoft.com/en-us/excel-help/create-or-delete-a-custom-number-format-HA102749035.aspx?CTT=1).<br/><br/> **Совет.** Чтобы увидеть, как выглядит строка формата для стандартной категории в диалоговом окне **Формат ячеек** в Excel, сделайте следующее:<br/><br/><ol><li>Выберите стандартную категорию формата, например <span class="ui">Денежный</span>, в списке <b>Категория</b>.</li><li>Задайте параметры формата в правой части диалогового окна.</li><li>Выберите категорию <b>(все форматы)</b>, чтобы просмотреть строку формата в верхней части списка <b>Тип</b>.</li></ol>|



**Параметры таблицы**


|**Клавиша**|**Значения**|**Примечания**|
|:-----|:-----|:-----|
| `style:`|"none" \| \<Все имена предопределенных стилей таблиц\>|Имена предопределенных стилей таблиц:<br/><br/>"TableStyleLight1", "TableStyleLight2", "TableStyleLight3", "TableStyleLight4", "TableStyleLight5", "TableStyleLight6", "TableStyleLight7", "TableStyleLight8", "TableStyleLight9", "TableStyleLight10", "TableStyleLight11", "TableStyleLight12", "TableStyleLight13", "TableStyleLight14", "TableStyleLight15", "TableStyleLight16", "TableStyleLight17", "TableStyleLight18", "TableStyleLight19", "TableStyleLight20", "TableStyleLight21", "TableStyleMedium1", "TableStyleMedium2", "TableStyleMedium3", "TableStyleMedium4", "TableStyleMedium5", "TableStyleMedium6", "TableStyleMedium7", "TableStyleMedium8", "TableStyleMedium9", "TableStyleMedium10", "TableStyleMedium11", "TableStyleMedium12", "TableStyleMedium13", "TableStyleMedium14", "TableStyleMedium15", "TableStyleMedium16", "TableStyleMedium17", "TableStyleMedium18", "TableStyleMedium19", "TableStyleMedium20", "TableStyleMedium21", "TableStyleMedium22", "TableStyleMedium23", "TableStyleMedium24", "TableStyleMedium25", "TableStyleMedium26", "TableStyleMedium27", "TableStyleMedium28", "TableStyleDark1", "TableStyleDark2", "TableStyleDark3", "TableStyleDark4", "TableStyleDark5", "TableStyleDark6", "TableStyleDark7", "TableStyleDark8", "TableStyleDark9", "TableStyleDark10", "TableStyleDark11"<br/><br/>Чтобы увидеть, как выглядит стиль таблицы, вставьте таблицу в Excel, на вкладке **Работа с таблицами** \| **Конструктор** выберите раскрывающееся меню **Экспресс-стили**, а затем выберите предопределенный стиль. Подсказка для стиля будет соответствовать одному из значений в списке выше.|
| `headerRow:`|**Логический**||
| `firstColumn:`|**Логический**||
| `filterButton:`|**Логический**||
| `totalRow:`|**Логический**||
| `lastColumn:`|**Логический**||
| `bandedRows:`|**Логический**||
| `bandedColumns:`|**Логический**||
